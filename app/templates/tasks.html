{% extends 'base.html' %}
{% block title %}Your Tasks{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto mt-8">

    <!-- Delete Profile Button -->
    <div class="flex justify-end mb-6">
        <form action="{{ url_for('auth.delete_profile') }}" method="POST"
              onsubmit="return confirm('Are you sure you want to delete your profile? All tasks will be removed!');">
            <button type="submit"
                    class="px-4 py-2 bg-red-600 hover:bg-red-500 text-white rounded-lg shadow-md transition">
                Delete Your Profile
            </button>
        </form>
    </div>

    <!-- Tasks Container -->
    <div class="bg-gray-800 bg-opacity-80 rounded-2xl p-6 shadow-lg">
        <h2 class="text-3xl font-bold text-green-400 mb-6 text-center">Your Tasks</h2>

        <!-- Add Task Form -->
        <form action="{{ url_for('tasks.add_task') }}" method="POST" class="flex gap-3 mb-6">
            <input type="text" name="title" placeholder="Enter new task"
                   class="flex-1 px-4 py-3 bg-gray-900 text-white rounded-lg border border-gray-700 focus:outline-none focus:border-green-500"
                   required>
            <button type="submit"
                    class="px-6 py-3 bg-green-600 hover:bg-green-500 text-white rounded-lg shadow-md transition">
                Add
            </button>
        </form>

        {% if tasks %}
            <!-- Clear All Tasks Button -->
            <form action="{{ url_for('tasks.clear_tasks') }}" method="POST" class="mb-6 text-right">
                <button type="submit"
                        class="px-6 py-3 bg-red-600 hover:bg-red-500 text-white rounded-lg shadow-md transition"
                        onclick="return confirm('Are you sure you want to clear all tasks?');">
                    Clear All Tasks
                </button>
            </form>

            <!-- Tasks Table -->
            <div class="overflow-x-auto">
                <table class="min-w-full bg-gray-900 rounded-lg overflow-hidden shadow-lg">
                    <thead class="bg-gray-700 text-green-400">
                        <tr>
                            <th class="py-3 px-4 text-left">#</th>
                            <th class="py-3 px-4 text-left">Task</th>
                            <th class="py-3 px-4 text-left">Status</th>
                            <th class="py-3 px-4 text-center">Change Status</th>
                            <th class="py-3 px-4 text-center">Delete</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for task in tasks %}
                        <tr class="border-b border-gray-700 hover:bg-gray-800">
                            <td class="py-3 px-4 text-gray-300">{{ loop.index }}</td>
                            <td class="py-3 px-4 text-gray-300">{{ task.title }}</td>
                            <td class="py-3 px-4">
                                <span class="px-3 py-1 rounded-full text-white text-sm font-semibold
                                    {% if task.status == 'Pending' %} bg-yellow-500
                                    {% elif task.status == 'Working' %} bg-blue-500
                                    {% else %} bg-green-600 {% endif %}">
                                    {{ task.status }}
                                </span>
                            </td>
                            <td class="py-3 px-4 text-center">
                                <form action="{{ url_for('tasks.toggle_status', task_id=task.id) }}" method="POST">
                                    <button type="submit"
                                            class="px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg transition">
                                        Next
                                    </button>
                                </form>
                            </td>
                            <td class="py-3 px-4 text-center">
                                <form action="{{ url_for('tasks.clear_task', task_id=task.id) }}" method="POST">
                                    <button type="submit"
                                            class="px-4 py-2 bg-red-600 hover:bg-red-500 text-white rounded-lg transition"
                                            onclick="return confirm('Delete this task?');">
                                        Delete
                                    </button>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <p class="text-center text-gray-400 mt-6 text-lg">No tasks yet. Add one above!</p>
        {% endif %}
    </div>
</div>
{% endblock %}
